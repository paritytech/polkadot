name: Check updated weights

on:
  pull_request:
    # uncomment before merging
    # paths:
      # - 'runtime/*/src/weights/'

jobs:
  check_weights_files:
    strategy:
      fail-fast: false
      matrix:
        runtime: [westend, kusama, polkadot, rococo]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout sources
        uses: actions/checkout@v3
      - name: Check weights files
        shell: bash
        run: |
          scripts/ci/github/verify_updated_weights.sh ${{ matrix.runtime }}
  check_weight_changes:
    strategy:
      fail-fast: false
      matrix:
        runtime: [westend, kusama, polkadot, rococo]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout sources
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Check weight changes
        shell: bash
        run: |
          cargo install --git https://github.com/ggwpez/substrate-weight-compare swc
          scripts/ci/github/check_weights_swc.sh
      - name: Upload weight changes
        id: upload_weight_changes
        uses: actions/upload-artifact@v2
        with:
          name: swc_output_${{ matrix.runtime }}
          path: swc_output_${{ matrix.runtime }}.txt
      - name: Add comment
        uses: thollander/actions-comment-pull-request@v2
        with:
          message: |
            Weight changes for runtime ${{ matrix.runtime }}:
            ```
            ${{ steps.upload_weight_changes.outputs.weight_changes }}
            ```
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}