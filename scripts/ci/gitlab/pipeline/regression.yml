zombienet-regression-test-balance-transfers:
  stage: zombienet
  image: "${ZOMBIENET_IMAGE}"
  extends:
    - .kubernetes-env
    - .zombienet-refs
  needs:
    - job: publish-polkadot-debug-image
      artifacts: true
  variables:
    GH_DIR: "https://github.com/paritytech/polkadot/tree/${CI_COMMIT_SHORT_SHA}/zombienet_tests/regression"
  before_script:
    - echo "Zombie-net Tests Config"
    - echo "${ZOMBIENET_IMAGE_NAME}"
    - echo "${GH_DIR}"
    - export DEBUG=zombie*
    - export ZOMBIENET_INTEGRATION_TEST_IMAGE=${PARACHAINS_IMAGE_NAME}:${PARACHAINS_IMAGE_TAG}
    - export MALUS_IMAGE=${MALUS_IMAGE_NAME}:${MALUS_IMAGE_TAG}
  script:
    - /home/nonroot/zombie-net/scripts/ci/run-test-env-manager.sh
      --github-remote-dir="${GH_DIR}"
      --test="0001-test-transfer.zndsl"
  allow_failure: false
  retry: 2
  tags:
    - zombienet-polkadot-regression-test
